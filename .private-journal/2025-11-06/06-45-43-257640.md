---
title: "6:45:43 AM - November 6, 2025"
date: 2025-11-06T11:45:43.257Z
timestamp: 1762429543257
---

## Project Notes

Image Browser Refactoring - Final Requirements:

1. **Table Naming**: Bucket name → sanitized table name (e.g., `my-bucket` → `my_bucket_embeddings`)
2. **R2_PREFIX**: REMOVED - simplifies configuration
3. **mlx-local**: Stays separate at root level, will update to support dynamic table names
4. **Migration**: Manual - user handles existing data, no automatic migration
5. **Structure**: Option A - src/{shared,syncer,server} with public/ at root
6. **Tooling**: Both npm scripts + mise.toml (mise wraps npm for convenience)
7. **Deployment**: Different machines but shared .env (same DB_URL, REPLICATE keys, R2 config)

Key architectural decisions:
- Single package.json with both syncer + server dependencies
- Shared code in src/shared: db.ts, r2.ts, replicate.ts
- DB connection: table name derived from R2_BUCKET env var
- Both syncer and server import from ../shared
- Each can run independently on different machines with same .env

Next steps:
1. Create new image-browser/ directory with proper structure
2. Merge db.ts files with bucket-based table naming
3. Copy r2.ts (remove prefix logic)
4. Merge replicate.ts (text + image methods)
5. Move syncer scripts
6. Move server + templates
7. Consolidate package.json
8. Update mise.toml
9. Update mlx-local Python code for dynamic tables
