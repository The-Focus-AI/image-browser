{
  "embedding": [
    -0.06823880225419998,
    0.00296467961743474,
    -0.020668068900704384,
    0.02900034561753273,
    0.07836706191301346,
    -0.013619286008179188,
    -0.04370599240064621,
    0.09232214093208313,
    -0.006675148382782936,
    0.061087459325790405,
    -0.015774883329868317,
    0.02775084599852562,
    -0.015319031663239002,
    -0.021004952490329742,
    -0.0045527140609920025,
    0.023629097267985344,
    -0.012276245281100273,
    -0.040358126163482666,
    0.019435107707977295,
    -0.06437104940414429,
    -0.010466360487043858,
    -0.02352321892976761,
    0.058616869151592255,
    -0.038093484938144684,
    0.060139670968055725,
    0.07160943001508713,
    -0.05796198546886444,
    -0.00701298238709569,
    -0.02792290225625038,
    -0.034241870045661926,
    0.02151135727763176,
    0.009517050348222256,
    -0.07642460614442825,
    0.03522952273488045,
    -0.0521516352891922,
    0.09795770049095154,
    -0.01169629953801632,
    -0.12470262497663498,
    -0.027358723804354668,
    -0.06206212192773819,
    0.059512749314308167,
    0.06054644659161568,
    -0.08264315873384476,
    -0.050523851066827774,
    -0.02693626657128334,
    -0.05873711779713631,
    -0.09779714047908783,
    -0.10953252017498016,
    0.003226443426683545,
    -0.017520559951663017,
    -0.12804992496967316,
    -0.033917076885700226,
    -0.031887225806713104,
    -0.03344042971730232,
    0.015760527923703194,
    0.03246765211224556,
    -0.044619400054216385,
    -0.0009688110440038145,
    0.06947824358940125,
    0.04754561185836792,
    0.06147337332367897,
    -0.04249265044927597,
    0.030920783057808876,
    -0.02626710943877697,
    0.06393948197364807,
    -0.02508399821817875,
    -0.029047075659036636,
    -0.005442675668746233,
    0.05179585516452789,
    -0.04753703624010086,
    -0.05198132246732712,
    0.06226349622011185,
    -0.06988842040300369,
    -0.06982631981372833,
    -0.07212642580270767,
    -0.08091949671506882,
    -0.001532096299342811,
    0.024533849209547043,
    -0.012166270986199379,
    -0.09996728599071503,
    0.010024746879935265,
    -0.04333515092730522,
    0.006488683167845011,
    0.06464657932519913,
    0.011342626065015793,
    0.019129477441310883,
    0.02564583718776703,
    -0.027423201128840446,
    0.05176802724599838,
    -0.07885919511318207,
    -0.015429183840751648,
    -0.06133546307682991,
    -0.05523719638586044,
    0.023917725309729576,
    -0.03471839055418968,
    0.04883188009262085,
    -0.050325483083724976,
    0.04516815021634102,
    -0.038473423570394516,
    0.06739509105682373,
    -0.01449489314109087,
    -0.018017396330833435,
    0.036675188690423965,
    0.05504957586526871,
    0.018503040075302124,
    -0.018683552742004395,
    0.05581755191087723,
    0.06903232634067535,
    -0.03536790609359741,
    0.027589399367570877,
    -0.010921841487288475,
    0.07874686270952225,
    -0.05990708991885185,
    -0.011555771343410015,
    -0.03562023118138313,
    -0.060129955410957336,
    0.030191570520401,
    -0.026550475507974625,
    0.00469729769974947,
    0.08780568838119507,
    0.14120152592658997,
    0.043632734566926956,
    -0.031290680170059204,
    0.036190617829561234,
    0.010960320010781288,
    -0.05727361515164375,
    0.05704855918884277,
    9.415036779570677e-33,
    0.05990001931786537,
    -0.06565096974372864,
    0.021855855360627174,
    0.053338244557380676,
    0.09496048837900162,
    0.004320708569139242,
    -0.0414966382086277,
    -0.011881094425916672,
    -0.10307857394218445,
    0.0636739432811737,
    -0.017470918595790863,
    0.08539271354675293,
    -0.07309416681528091,
    0.039104707539081573,
    0.015235679224133492,
    -0.12149723619222641,
    0.06507716327905655,
    0.032351646572351456,
    0.06528569757938385,
    -0.04322180151939392,
    0.02444920316338539,
    -0.022700965404510498,
    -0.05521363392472267,
    0.05932300165295601,
    0.01923741027712822,
    0.023396113887429237,
    -0.004967906512320042,
    0.025541312992572784,
    -0.08393697440624237,
    -0.01470954343676567,
    0.09457088261842728,
    0.000973277841694653,
    -0.03492056950926781,
    0.03892049565911293,
    -0.01834219880402088,
    -0.08770684152841568,
    -0.02840839885175228,
    -0.03606484457850456,
    -0.12729963660240173,
    0.05347983166575432,
    0.017434876412153244,
    -0.007172424346208572,
    -0.11728590726852417,
    -0.029405882582068443,
    -0.11879163235425949,
    0.006235490087419748,
    -0.00029582306160591543,
    0.009468598291277885,
    0.08979244530200958,
    0.011395572684705257,
    -0.12680864334106445,
    0.013480383902788162,
    -0.011593816801905632,
    -0.008279797621071339,
    0.07145494222640991,
    -0.012939807958900928,
    -0.006433450151234865,
    -0.014028706587851048,
    0.07907082885503769,
    0.00469476543366909,
    -0.0027008301112800837,
    -0.014806010760366917,
    -0.04297732189297676,
    -0.0444786362349987,
    0.017085930332541466,
    0.01522062998265028,
    -0.025205329060554504,
    0.026738785207271576,
    0.08305908739566803,
    0.042723916471004486,
    -0.06105947494506836,
    0.04702647030353546,
    0.09949267655611038,
    0.02816518023610115,
    0.04083835333585739,
    -0.039121583104133606,
    -0.08992723375558853,
    0.0026461812667548656,
    -0.08411715924739838,
    -0.0028357699047774076,
    -0.051096461713314056,
    -0.042371466755867004,
    -0.1230543777346611,
    0.03180130198597908,
    0.0672498345375061,
    -0.02651350200176239,
    0.011086220853030682,
    -0.02811029553413391,
    -0.04226112738251686,
    -0.0012253845343366265,
    -0.022769011557102203,
    -0.03947722166776657,
    0.035399824380874634,
    -0.09262552857398987,
    -0.14931164681911469,
    -1.0451155703951843e-32,
    0.016010094434022903,
    0.015665750950574875,
    -0.02118760719895363,
    0.003355396445840597,
    -0.013118615373969078,
    0.02257019653916359,
    0.06919872015714645,
    0.06533125042915344,
    -0.02368856966495514,
    0.0077951340936124325,
    -0.0007499640923924744,
    0.024456914514303207,
    0.031171243637800217,
    -0.05009358003735542,
    -0.06509076058864594,
    0.13282905519008636,
    -0.03446631133556366,
    -0.09081238508224487,
    -0.0186613779515028,
    -0.04405542090535164,
    -0.08826630562543869,
    0.1300363689661026,
    0.04629064351320267,
    0.06923279911279678,
    -0.024471158161759377,
    0.05903112515807152,
    0.07578980922698975,
    0.03395658731460571,
    -0.061341263353824615,
    -0.038110699504613876,
    0.0026370889972895384,
    0.03680248185992241,
    -0.09877453744411469,
    0.025486979633569717,
    -0.028248026967048645,
    -0.021619776263833046,
    0.030341336503624916,
    0.06300719827413559,
    -0.04104987159371376,
    0.03794069215655327,
    0.06253331154584885,
    -0.0407257117331028,
    -0.04361497983336449,
    0.044327814131975174,
    -0.014934840612113476,
    -0.016477270051836967,
    0.05608396232128143,
    -0.005596409551799297,
    -0.029717128723859787,
    -0.06618103384971619,
    0.03384776785969734,
    -0.07199981808662415,
    -0.02964240498840809,
    -0.013487372547388077,
    0.02387259714305401,
    -0.027175454422831535,
    -0.008627275936305523,
    -0.012464628554880619,
    0.0004768247890751809,
    -0.019865859299898148,
    0.13698096573352814,
    -0.04958493262529373,
    -0.03486000746488571,
    -0.013519970700144768,
    0.009347094222903252,
    -0.04200069233775139,
    -0.10956311225891113,
    0.02353525720536709,
    0.029214609414339066,
    0.008865786716341972,
    -0.06631231307983398,
    0.021207435056567192,
    0.10820312052965164,
    -0.010998953133821487,
    0.06915915757417679,
    0.002815937390550971,
    0.04274996370077133,
    -0.03562106192111969,
    0.062057845294475555,
    0.021710064262151718,
    -0.07668036967515945,
    0.027077702805399895,
    -0.035736214369535446,
    -0.06962225586175919,
    -0.006205924320966005,
    -0.02578287199139595,
    -0.08391760289669037,
    0.07937434315681458,
    0.021725932136178017,
    -0.017728108912706375,
    -0.08316976577043533,
    0.029697110876441002,
    -0.00876210443675518,
    0.07328012585639954,
    0.0577862486243248,
    -6.516185635518923e-8,
    0.0019316801335662603,
    -0.010718791745603085,
    -0.041243866086006165,
    -0.014622831717133522,
    0.017869682982563972,
    0.011488943360745907,
    0.095540851354599,
    0.0375930592417717,
    -0.015374989248812199,
    0.015014530159533024,
    0.023608986288309097,
    0.037075649946928024,
    -0.04854447767138481,
    0.033133894205093384,
    -0.011377069167792797,
    0.02971768192946911,
    -0.0052309404127299786,
    0.14318625628948212,
    -0.025494609028100967,
    -0.02635306678712368,
    -0.015289840288460255,
    -0.029177425429224968,
    0.006200809497386217,
    -0.009088066406548023,
    0.03267306461930275,
    0.002313293982297182,
    -0.023905767127871513,
    -0.01699022203683853,
    -0.029092712327837944,
    -0.033011507242918015,
    0.008395029231905937,
    -0.01282942108809948,
    0.07372993230819702,
    -0.05203917250037193,
    -0.0007795324199832976,
    -0.0034633392933756113,
    0.013102767057716846,
    0.027229171246290207,
    -0.000767299032304436,
    0.04512247070670128,
    0.012004642747342587,
    -0.007678741589188576,
    0.026003144681453705,
    0.030437244102358818,
    0.00019274934311397374,
    0.007748240604996681,
    0.0037396345287561417,
    0.0559346079826355,
    0.029410280287265778,
    0.0015204455703496933,
    0.02184801548719406,
    -0.08527196943759918,
    -0.06184139847755432,
    0.044079627841711044,
    0.049014877527952194,
    -0.015126177109777927,
    0.03782479837536812,
    -0.040456242859363556,
    0.029091300442814827,
    -0.021176956593990326,
    0.0874512791633606,
    -0.006177861709147692,
    0.017752334475517273,
    -0.06435125321149826
  ],
  "text": "### Frontend Framework\n- **Not using React/Vue** - This is a **server-rendered HTML application**\n- Single HTML template served from `/src/server/template.html`\n- Client-side JS is inline in the template (vanilla JavaScript, no framework)\n- Content is rendered on the server side\n\n### Environment Variables Configuration\n- **Location**: `/Users/wschenk/The-Focus-AI/image-browser/.env`\n- Loaded via `dotenv.config()` in `/src/server.ts` (line 11)\n- Variables read directly from `process.env` throughout the app\n- Key vars: SUPABASE_DB_URL, REPLICATE_API_TOKEN, IMAGES_DIR, IMAGE_BASE_URL, PORT, etc.\n\n### Main Entry Point\n- **Server file**: `/src/server.ts` - main Express server\n- **Port**: 3000 (configurable via PORT env var)\n- **Startup**: `tsx src/server.ts` in development, `node dist/server.js` in production\n\n### Image Gallery/Browser Rendering\n- **Template location**: `/src/server/template.html` (8784 bytes)\n- **Rendered by**: `renderTemplate()` function in server.ts (lines 139-159)\n- HTML structure: masonry layout with images\n- Images served from either local `/images` dir or remote R2 bucket\n\n### UI Components & Modals\nThe template includes:\n- **Stats widget** (fixed position, top-right): shows dataset progress\n- **Modal dialog**: for stats details (already has modal overlay implementation at lines 28-71)\n- **Loading overlay**: shown when searches > 500ms (lines 38-41)\n- **Icon buttons**: Google Lens and download buttons on hover\n\n### Key Routes\n- `GET /` - search or list images\n- `GET /stats` - JSON stats endpoint\n- `GET /neighbors/:file_name` - find similar images\n\n### Database\n- **PostgreSQL** via Supabase\n- Vector embeddings for semantic search\n- Table derived from bucket name (e.g., \"ffffound_embeddings\")\n- Schema includes: id, file_name, width, height, embedding, created_at\n\n### Best Locations for NSFW Gate Feature\n\n1. **Environment Variable**: Add to `.env` file (or validate in validate-env.ts)\n   - `NSFW_GATE=true` or `NSFW_GATE_ENABLED=true`\n\n2. **Overlay Component**: Add to `/src/server/template.html`\n   - Use existing modal pattern (similar to stats modal)\n   - Position: fixed, full-screen warning before masonry loads\n   - Can be hidden via localStorage after acknowledgment\n\n3. **Server-side Integration**:\n   - Read `NSFW_GATE` in `/src/server.ts` (like other env vars)\n   - Pass via template replacement (like `{{PAGE_TITLE}}`)\n   - Template can conditionally show/hide overlay based on var\n\n4. **Client-side Logic**:\n   - Add JavaScript in template (inline scripts section)\n   - Check localStorage for user acknowledgment\n   - Show modal on first load if enabled\n   - Hide after user clicks \"I understand\"\n\n### Architecture Pattern\nThis is a **traditional server-rendered app** with:\n- Backend: Express + PostgreSQL + Node.js\n- Frontend: Server-side HTML generation + vanilla JS\n- No React/Vue framework\n- Simple, lightweight approach suitable for image gallery",
  "sections": [
    "Project Notes",
    "Architecture Exploration: Image Browser NSFW Gate"
  ],
  "timestamp": 1762454790610,
  "path": "/Users/wschenk/The-Focus-AI/image-browser/.private-journal/2025-11-06/13-46-30-610450.md"
}